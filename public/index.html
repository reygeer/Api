<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego de Malilla Multijugador</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1e293b;
      color: white;
      padding: 20px;
      text-align: center;
    }

    h1 {
      margin-bottom: 20px;
    }

    .nombre-input {
      margin-bottom: 20px;
    }

    input {
      padding: 8px;
      border-radius: 6px;
      border: none;
      margin: 5px;
    }

    button {
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      background-color: #38bdf8;
      color: black;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
    }

    .cartas-container {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 10px;
      justify-items: center;
      margin-top: 20px;
    }

    .carta {
      width: 80px;
      height: 120px;
      background-color: white;
      color: black;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
      user-select: none;
    }

    .carta:hover {
      transform: scale(1.05);
    }

    .carta.seleccionada {
      background-color: #ff00fb;
      color: white;
      box-shadow: 0 0 10px #38bdf8;
    }

    .jugadores {
      margin-top: 30px;
      text-align: left;
    }

    .jugador {
      margin: 8px 0;
    }
  </style>
</head>
<body>

  <h1>Juego de Malilla Multijugador</h1>

  <div class="nombre-input">
    <input type="text" id="nombre" placeholder="Tu nombre">
    <input type="text" id="sala" placeholder="Código de sala">
    <button id="btnCrear">Crear Sala</button>
    <button id="btnUnirse">Unirse</button>
  </div>

  <div class="cartas-container" id="cartasContainer"></div>

  <h2>Jugadores en la sala</h2>
  <div class="jugadores" id="jugadores"></div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    const palos = ["Oros", "Copas", "Espadas", "Bastos"];
    const valores = ["2", "3", "4", "5", "6", "J", "Q", "K", "A", "7"];

    const container = document.getElementById('cartasContainer');
    const jugadoresDiv = document.getElementById('jugadores');

    const socket = io(); // Se conecta al mismo servidor

    // Generar cartas
    palos.forEach(palo => {
      valores.forEach(valor => {
        const carta = document.createElement('div');
        carta.className = 'carta';
        carta.innerHTML = `
          <div class="numero">${valor}</div>
          <div class="palo">${palo}</div>
        `;
        carta.addEventListener('click', () => {
          const sala = document.getElementById('sala').value;
          socket.emit('cartaSeleccionada', { valor, palo, sala });
          carta.classList.toggle('seleccionada');
        });
        container.appendChild(carta);
      });
    });

    // Función para generar código de sala aleatorio
    function generarCodigoSala(longitud = 6) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let codigo = "";
      for (let i = 0; i < longitud; i++) {
        codigo += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return codigo;
    }

    // Crear sala
    document.getElementById("btnCrear").addEventListener("click", () => {
      const nombre = document.getElementById("nombre").value;
      if (!nombre) {
        alert("Ingresa tu nombre primero");
        return;
      }

      const sala = generarCodigoSala(); // Código aleatorio
      document.getElementById("sala").value = sala; // Mostrarlo en el input

      socket.emit("crearSala", { nombre, sala });
    });

    // Unirse a sala
    document.getElementById('btnUnirse').addEventListener('click', () => {
      const nombre = document.getElementById('nombre').value;
      const sala = document.getElementById('sala').value;
      if (nombre && sala) {
        socket.emit('unirseSala', { nombre, sala });
      }
    });

    // Confirmación de sala creada
    socket.on("salaCreada", (sala) => {
      alert(`Sala creada con código: ${sala}`);
    });

    // Error al intentar unirse
    socket.on("errorSala", (msg) => {
      alert(msg);
    });

    // Actualizar lista de jugadores
    socket.on('listaJugadores', (jugadores) => {
      jugadoresDiv.innerHTML = '';
      Object.values(jugadores).forEach(jugador => {
        const div = document.createElement('div');
        div.className = 'jugador';
        div.textContent = jugador.nombre;
        jugadoresDiv.appendChild(div);
      });
    });

    // Estado de la sala (quién seleccionó qué cartas)
    socket.on('estadoJuego', (jugadores) => {
      console.log("Estado de la sala:", jugadores);
    });
  </script>
</body>
</html>
